"""Pipe schedule to internal diameter conversions."""
from __future__ import annotations

from typing import Dict

# Inner diameters sourced from the VB reference implementation (in millimetres)
PIPE_SCHEDULE_DATA: Dict[str, Dict[float, float]] = {
    "10": {
        0.125: 0.00782,
        0.25: 0.0104,
        0.375: 0.0138,
        0.5: 0.01708,
        0.75: 0.02248,
        1.0: 0.02786,
        1.25: 0.03666,
        1.5: 0.04276,
        2.0: 0.05476,
        2.5: 0.0669,
        3.0: 0.0828,
        3.5: 0.0955,
        4.0: 0.1082,
        5.0: 0.1345,
        6.0: 0.1615,
        8.0: 0.21158,
        10.0: 0.26462,
        12.0: 0.31466,
        14.0: 0.3429,
        16.0: 0.3937,
        18.0: 0.4443,
        20.0: 0.4953,
        22.0: 0.5463,
        24.0: 0.5973,
        26.0: 0.64416,
        28.0: 0.69516,
        30.0: 0.74616,
        32.0: 0.79716,
        34.0: 0.84816,
        36.0: 0.89816,
    },
    "100": {
        8.0: 0.18892,
        10.0: 0.23648,
        12.0: 0.28092,
        14.0: 0.30794,
        16.0: 0.35402,
        18.0: 0.39828,
        20.0: 0.44292,
        22.0: 0.48914,
        24.0: 0.53222,
    },
    "10s": {
        0.125: 0.00782,
        0.25: 0.0104,
        0.375: 0.0138,
        0.5: 0.01708,
        0.75: 0.02248,
        1.0: 0.02786,
        1.25: 0.03666,
        1.5: 0.04276,
        2.0: 0.05476,
        2.5: 0.0669,
        3.0: 0.0828,
        3.5: 0.0955,
        4.0: 0.1082,
        5.0: 0.1345,
        6.0: 0.1615,
        8.0: 0.21158,
        10.0: 0.26472,
        12.0: 0.31476,
        14.0: 0.34604,
        16.0: 0.39684,
        18.0: 0.44744,
        20.0: 0.49692,
        22.0: 0.54792,
        24.0: 0.5973,
        30.0: 0.74616,
    },
    "120": {
        4.0: 0.09204,
        5.0: 0.1159,
        6.0: 0.13976,
        8.0: 0.18258,
        10.0: 0.23012,
        12.0: 0.273,
        14.0: 0.30002,
        16.0: 0.34448,
        18.0: 0.38714,
        20.0: 0.4318,
        22.0: 0.47644,
        24.0: 0.51796,
    },
    "140": {
        8.0: 0.17786,
        10.0: 0.2222,
        12.0: 0.26664,
        14.0: 0.2921,
        16.0: 0.33334,
        18.0: 0.37766,
        20.0: 0.4191,
        22.0: 0.46374,
        24.0: 0.50526,
    },
    "160": {
        0.5: 0.01174,
        0.75: 0.01558,
        1.0: 0.0207,
        1.25: 0.0295,
        1.5: 0.03402,
        2.0: 0.04282,
        2.5: 0.05394,
        3.0: 0.06664,
        4.0: 0.08732,
        5.0: 0.10954,
        6.0: 0.13178,
        8.0: 0.17308,
        10.0: 0.21584,
        12.0: 0.25716,
        14.0: 0.28418,
        16.0: 0.32542,
        18.0: 0.36652,
        20.0: 0.40798,
        22.0: 0.45104,
        24.0: 0.49092,
    },
    "20": {
        8.0: 0.2064,
        10.0: 0.2603,
        12.0: 0.3111,
        14.0: 0.33976,
        16.0: 0.39056,
        18.0: 0.44116,
        20.0: 0.48894,
        22.0: 0.53994,
        24.0: 0.59094,
        26.0: 0.6346,
        28.0: 0.6856,
        30.0: 0.7366,
        32.0: 0.7876,
        34.0: 0.8386,
        36.0: 0.8886,
    },
    "30": {
        0.125: 0.0074,
        0.25: 0.01,
        0.375: 0.0134,
        0.5: 0.01648,
        0.75: 0.02188,
        1.0: 0.0276,
        1.25: 0.03626,
        1.5: 0.04194,
        2.0: 0.05394,
        2.5: 0.06344,
        3.0: 0.07934,
        3.5: 0.09204,
        4.0: 0.10474,
        8.0: 0.20502,
        10.0: 0.2574,
        12.0: 0.30704,
        14.0: 0.33654,
        16.0: 0.38734,
        18.0: 0.43474,
        20.0: 0.4826,
        22.0: 0.5336,
        24.0: 0.58146,
        28.0: 0.67924,
        30.0: 0.73024,
        32.0: 0.78124,
        34.0: 0.83224,
        36.0: 0.88224,
    },
    "40": {
        0.125: 0.00684,
        0.25: 0.00922,
        0.375: 0.01248,
        0.5: 0.01576,
        0.75: 0.02096,
        1.0: 0.02664,
        1.25: 0.03508,
        1.5: 0.04094,
        2.0: 0.05248,
        2.5: 0.06268,
        3.0: 0.07792,
        3.5: 0.09012,
        4.0: 0.10226,
        5.0: 0.1282,
        6.0: 0.15408,
        8.0: 0.20274,
        10.0: 0.25446,
        12.0: 0.30318,
        14.0: 0.33334,
        16.0: 0.381,
        18.0: 0.42846,
        20.0: 0.47782,
        24.0: 0.57504,
        32.0: 0.77804,
        34.0: 0.82904,
        36.0: 0.8759,
    },
    "40s": {
        0.125: 0.00684,
        0.25: 0.00922,
        0.375: 0.01248,
        0.5: 0.01576,
        0.75: 0.02096,
        1.0: 0.02664,
        1.25: 0.03508,
        1.5: 0.04094,
        2.0: 0.05248,
        2.5: 0.06268,
        3.0: 0.07792,
        3.5: 0.09012,
        4.0: 0.10226,
        5.0: 0.1282,
        6.0: 0.15408,
        8.0: 0.20274,
        10.0: 0.25456,
        12.0: 0.30484,
        14.0: 0.33654,
        16.0: 0.38734,
        18.0: 0.43794,
        20.0: 0.48894,
        24.0: 0.59094,
    },
    "5": {
        0.5: 0.018,
        0.75: 0.0234,
        1.0: 0.0301,
        1.25: 0.0389,
        1.5: 0.045,
        2.0: 0.057,
        2.5: 0.06878,
        3.0: 0.08468,
        3.5: 0.09738,
        4.0: 0.11008,
        5.0: 0.13576,
        6.0: 0.16276,
        8.0: 0.21356,
        10.0: 0.2662,
        12.0: 0.31588,
        14.0: 0.34768,
        16.0: 0.39802,
        18.0: 0.44862,
        20.0: 0.49844,
        22.0: 0.54944,
        24.0: 0.59892,
        30.0: 0.7493,
    },
    "5s": {
        0.5: 0.018,
        0.75: 0.0234,
        1.0: 0.0301,
        1.25: 0.0389,
        1.5: 0.045,
        2.0: 0.057,
        2.5: 0.06878,
        3.0: 0.08468,
        3.5: 0.09738,
        4.0: 0.11008,
        5.0: 0.13576,
        6.0: 0.16276,
        8.0: 0.21356,
        10.0: 0.2663,
        12.0: 0.31598,
        14.0: 0.34768,
        16.0: 0.39802,
        18.0: 0.44862,
        20.0: 0.49844,
        22.0: 0.54944,
        24.0: 0.59892,
        30.0: 0.7493,
    },
    "60": {
        8.0: 0.19848,
        10.0: 0.2476,
        12.0: 0.29526,
        14.0: 0.32542,
        16.0: 0.37308,
        18.0: 0.4189,
        20.0: 0.46676,
        22.0: 0.51454,
        24.0: 0.56078,
    },
    "80": {
        0.125: 0.00548,
        0.25: 0.00766,
        0.375: 0.0107,
        0.5: 0.01384,
        0.75: 0.01888,
        1.0: 0.0243,
        1.25: 0.0325,
        1.5: 0.03814,
        2.0: 0.04922,
        2.5: 0.05898,
        3.0: 0.07366,
        3.5: 0.08544,
        4.0: 0.09718,
        5.0: 0.12224,
        6.0: 0.14636,
        8.0: 0.1937,
        10.0: 0.24282,
        12.0: 0.28884,
        14.0: 0.3175,
        16.0: 0.36352,
        18.0: 0.40934,
        20.0: 0.45562,
        22.0: 0.50184,
        24.0: 0.54808,
    },
    "80s": {
        0.125: 0.00548,
        0.25: 0.00766,
        0.375: 0.0107,
        0.5: 0.01384,
        0.75: 0.01888,
        1.0: 0.0243,
        1.25: 0.0325,
        1.5: 0.03814,
        2.0: 0.04922,
        2.5: 0.05898,
        3.0: 0.07366,
        3.5: 0.08544,
        4.0: 0.09718,
        5.0: 0.12224,
        6.0: 0.14636,
        8.0: 0.1937,
        10.0: 0.2477,
        12.0: 0.2985,
        14.0: 0.3302,
        16.0: 0.381,
        18.0: 0.4316,
        20.0: 0.4826,
        24.0: 0.5846,
    },
    "std": {
        0.125: 0.00684,
        0.25: 0.00922,
        0.375: 0.01248,
        0.5: 0.01576,
        0.75: 0.02096,
        1.0: 0.02664,
        1.25: 0.03508,
        1.5: 0.04094,
        2.0: 0.05248,
        2.5: 0.06268,
        3.0: 0.07792,
        3.5: 0.09012,
        4.0: 0.10226,
        5.0: 0.1282,
        6.0: 0.15408,
        8.0: 0.20274,
        10.0: 0.25446,
        12.0: 0.30474,
        14.0: 0.33654,
        16.0: 0.38734,
        18.0: 0.43794,
        20.0: 0.48894,
        22.0: 0.53994,
        24.0: 0.59094,
        26.0: 0.64094,
        28.0: 0.69194,
        30.0: 0.74294,
        32.0: 0.79394,
        34.0: 0.84494,
        36.0: 0.89494,
        38.0: 0.94594,
        40.0: 0.99694,
        42.0: 1.04794,
        44.0: 1.09894,
        46.0: 1.14894,
        48.0: 1.19994,
    },
    "xs": {
        0.125: 0.00548,
        0.25: 0.00766,
        0.375: 0.0107,
        0.5: 0.01384,
        0.75: 0.01888,
        1.0: 0.0243,
        1.25: 0.0325,
        1.5: 0.03814,
        2.0: 0.04922,
        2.5: 0.05898,
        3.0: 0.07366,
        3.5: 0.08544,
        4.0: 0.09718,
        5.0: 0.12224,
        6.0: 0.14636,
        8.0: 0.1937,
        10.0: 0.2476,
        12.0: 0.2984,
        14.0: 0.3302,
        16.0: 0.381,
        18.0: 0.4316,
        20.0: 0.4826,
        22.0: 0.5336,
        24.0: 0.5846,
        26.0: 0.6346,
        28.0: 0.6856,
        30.0: 0.7366,
        32.0: 0.7876,
        34.0: 0.8386,
        36.0: 0.8886,
        38.0: 0.9396,
        40.0: 0.9906,
        42.0: 1.0416,
        44.0: 1.0926,
        46.0: 1.1426,
        48.0: 1.1936,
    },
    "xxs": {
        0.5: 0.00636,
        0.75: 0.01106,
        1.0: 0.01522,
        1.25: 0.0228,
        1.5: 0.028,
        2.0: 0.03816,
        2.5: 0.04496,
        3.0: 0.05842,
        4.0: 0.08006,
        5.0: 0.1032,
        6.0: 0.1244,
        8.0: 0.17464,
        10.0: 0.2222,
        12.0: 0.273,
    },
}


def inner_diameter_from_nps(nps: float, schedule: str) -> float:
    """Return the internal diameter in meters for a given NPS and schedule."""
    if nps is None:
        raise ValueError("Nominal pipe diameter (NPS) must be provided")
    if not schedule:
        raise ValueError("Pipe schedule must be provided")
    sched_key = schedule.strip().lower()
    table = PIPE_SCHEDULE_DATA.get(sched_key)
    if table is None:
        raise ValueError(f"Unsupported pipe schedule '{schedule}'")
    nps_key = float(nps)
    diameter = table.get(nps_key)
    if diameter is None:
        raise ValueError(f"NPS {nps} is unavailable for schedule '{schedule}'")
    return diameter
